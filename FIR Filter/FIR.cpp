#include "FIR.h"

static float FIR_FILTER_IMPULSE_RESPONSE[FIR_FILTER_LENGTH] = {-0.037324784577108999217287532701448071748, 0.00941785806349326216901918229496004642 , 0.009160818878514038685056952715513034491, 0.009311682130997627621082912696692801546, 0.009649060027583152010510758600503322668, 0.009941951762503066850062971582246973412, 0.009992272560189158908672268921691284049, 0.009630926615831163564718231384631508263, 0.008763412008987945742144454186473012669, 0.007350810864838454479486262727050416288, 0.00543649749377678268708047326640553365 , 0.003114160413563874050396629300507811422, 0.000560113048733610241654290451407405271,-0.002005427877020071747438123566098511219,-0.004332656096404860490700627906335284933,-0.006212379949987930846666550621648639208,-0.007392154626764898400770320563424320426,-0.007739916129823790937047878202292849892,-0.007154439452264792741187360292087760172,-0.005653120111950992940363924788016447565,-0.003329961090723477980940492315653500555,-0.000387606082359970489405187610287839561, 0.002900328607703136704620838770551927155, 0.006188916881751025528268783659768814687, 0.009118437768260248890705987889759853715, 0.01132678927729360157661275820828450378 , 0.012503361072239708301490068720340786967, 0.012408939332967227481274719025350350421, 0.010928383563942946007929712948225642322, 0.008070852616041805996371927278687508078, 0.004002875070304228941053814594397408655,-0.000989454906070954447530607644978317694,-0.006458011270217973477658635061970926472,-0.011886801523903235688894852728481055237,-0.016676969678623542597817319688147108536,-0.020244409810345753708560323502751998603,-0.022009051433144771747763002167630475014,-0.021523322288534690177597141769183508586,-0.018438346058580381420233251787976769265,-0.012630608792715252580718399144643626641,-0.00411229085717116065595844176527862146 , 0.006810019577257505306311369253080556518, 0.019747738094028074312680232083039300051, 0.033984959975991872738187993263636599295, 0.048781346397788249991123166182660497725, 0.063365153602884152772567460942809702829, 0.076741252285912747721496884878433775157, 0.088147283708783788491736288506217533723, 0.096850237937273569999163669308472890407, 0.10232672949946966522993818671238841489 , 0.104185060651533850650807266902120318264, 0.10232672949946966522993818671238841489 , 0.096850237937273569999163669308472890407, 0.088147283708783788491736288506217533723, 0.076741252285912747721496884878433775157, 0.063365153602884152772567460942809702829, 0.048781346397788249991123166182660497725, 0.033984959975991872738187993263636599295, 0.019747738094028074312680232083039300051, 0.006810019577257505306311369253080556518,-0.00411229085717116065595844176527862146 ,-0.012630608792715252580718399144643626641,-0.018438346058580381420233251787976769265,-0.021523322288534690177597141769183508586,-0.022009051433144771747763002167630475014,-0.020244409810345753708560323502751998603,-0.016676969678623542597817319688147108536,-0.011886801523903235688894852728481055237,-0.006458011270217973477658635061970926472,-0.000989454906070954447530607644978317694, 0.004002875070304228941053814594397408655, 0.008070852616041805996371927278687508078, 0.010928383563942946007929712948225642322, 0.012408939332967227481274719025350350421, 0.012503361072239708301490068720340786967, 0.01132678927729360157661275820828450378 , 0.009118437768260248890705987889759853715, 0.006188916881751025528268783659768814687, 0.002900328607703136704620838770551927155,-0.000387606082359970489405187610287839561,-0.003329961090723477980940492315653500555,-0.005653120111950992940363924788016447565,-0.007154439452264792741187360292087760172,-0.007739916129823790937047878202292849892,-0.007392154626764898400770320563424320426,-0.006212379949987930846666550621648639208,-0.004332656096404860490700627906335284933,-0.002005427877020071747438123566098511219, 0.000560113048733610241654290451407405271, 0.003114160413563874050396629300507811422, 0.00543649749377678268708047326640553365 , 0.007350810864838454479486262727050416288, 0.008763412008987945742144454186473012669, 0.009630926615831163564718231384631508263, 0.009992272560189158908672268921691284049, 0.009941951762503066850062971582246973412, 0.009649060027583152010510758600503322668, 0.009311682130997627621082912696692801546, 0.009160818878514038685056952715513034491, 0.00941785806349326216901918229496004642 ,-0.037324784577108999217287532701448071748};
void FIRFilter_init(FIRFilter *fir){
    for(int i = 0; i < FIR_FILTER_LENGTH; i++){
        fir->buff[i] = 0.0f;
    }

    fir->buffIndex = 0;
    fir->out = 0.0f;
}

float FIRFilter_calc(FIRFilter *fir, float inputVal){

    float out=0.0f;
    if(fir->buffIndex == FIR_FILTER_LENGTH){
        fir->buffIndex = 0;
    }
    fir->buff[fir->buffIndex] = inputVal;
    uint8_t buffIndex_temp = fir->buffIndex;

    fir->out = 0.0f;
    for(int i = 0; i < FIR_FILTER_LENGTH; i++){
        if(buffIndex_temp == 0){
            buffIndex_temp = FIR_FILTER_LENGTH - 1;
        }

        fir->out = fir->out + fir->buff[buffIndex_temp] * FIR_FILTER_IMPULSE_RESPONSE[i];
        buffIndex_temp--;
    }
    fir->buffIndex++;

    return out;
} 
